---
import { Briefcase, GraduationCap, MapPin, Calendar, ExternalLink } from 'lucide-preact';
import { getCollection } from 'astro:content';

const allTimelineItems = await getCollection('timeline');

const timelineItems = allTimelineItems.map(item => ({
    ...item.data,
    uniqueId: item.id
})).sort((a, b) => {
  const dateA = a.startDate || '0000-00';
  const dateB = b.startDate || '0000-00';
  return dateB.localeCompare(dateA); 
});

const getAccentColor = (type: string) => {
    switch (type) {
      case 'work': return '#002B5B'; // portfolio-navy
      case 'education': return '#1A5F7A'; // portfolio-royal-blue
      default: return '#002B5B';
    }
};

const getAccentClass = (type: string) => {
    return type === 'work' ? 'portfolio-navy' : 'portfolio-royal-blue';
};
---

<section id="timeline" class="py-20 md:py-24 relative bg-transparent transition-colors duration-500 overflow-hidden">
  <!-- Dynamic Background Ambient -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-1/4 -left-20 w-96 h-96 bg-portfolio-royal-blue/5 rounded-full blur-3xl animate-pulse-slow"></div>
    <div class="absolute bottom-1/4 -right-20 w-[30rem] h-[30rem] bg-portfolio-navy/5 rounded-full blur-3xl animate-pulse-slower"></div>
  </div>

  <div class="max-w-5xl mx-auto px-6 relative z-10">
    <!-- Header (Matched with About.astro) -->
    <div class="text-center mb-16 animate-on-scroll">
      <div class="flex items-center justify-center mb-6">
        <div class="h-px w-16 bg-gradient-to-r from-transparent to-portfolio-navy/50"></div>
        <div class="mx-4 px-6 py-1 rounded-full border border-portfolio-navy/20 bg-gradient-to-r from-portfolio-navy/5 to-portfolio-royal-blue/5">
          <span class="text-xs font-medium tracking-widest uppercase text-portfolio-navy">Journey</span>
        </div>
        <div class="h-px w-16 bg-gradient-to-l from-transparent to-portfolio-royal-blue/50"></div>
      </div>

      <h2 class="text-4xl md:text-5xl font-bold text-black dark:text-white mb-6 tracking-tight">
        Experience & Education
      </h2>
      <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
        A chronological overview of my professional path and academic foundations.
      </p>
    </div>

    <!-- Timeline Wrapper -->
    <div class="relative pl-6 md:pl-12">
      <!-- High-Tech Left Axis -->
      <div class="absolute left-0 top-[30px] bottom-0 w-[2px] overflow-hidden">
        <div class="h-full w-full bg-slate-300 dark:bg-white/10"></div>
        <!-- Animated Progress/Pulse Line (Starts from first event node center) -->
        <div class="absolute top-0 left-0 w-full h-[50%] bg-gradient-to-b from-transparent via-portfolio-royal-blue to-transparent animate-track-flow"></div>
      </div>

      <div class="space-y-8 md:space-y-12">
        {timelineItems.map((item, index) => {
            const isWork = item.type === 'work';
            const accentClass = getAccentClass(item.type);
            const Icon = isWork ? Briefcase : GraduationCap;
            
            return (
                <div class="relative group animate-on-scroll" style={`animation-delay: ${(index % 3) * 150}ms`}>
                    
                    <!-- Vertical Node Anchor -->
                    <div class="absolute -left-[19px] md:-left-[53px] top-6 z-20">
                        <div class={`w-3 h-3 rounded-full bg-white dark:bg-black border-2 border-${accentClass} group-hover:scale-150 transition-transform duration-300 shadow-[0_0_15px_rgba(26,95,122,0.4)]`}></div>
                    </div>

                    <div class="flex flex-col md:flex-row md:items-start gap-2 md:gap-12">
                        <!-- Date Column -->
                        <div class="flex flex-col md:w-32 flex-shrink-0 pt-0 md:pt-6 mb-2 md:mb-0">
                            <span class="text-xs md:text-sm font-bold text-gray-400 dark:text-gray-500 tracking-wider">
                                {item.duration}
                            </span>
                        </div>

                        <!-- Content Card -->
                        <div class="flex-grow">
                            <div class="relative p-6 md:p-8 rounded-2xl md:rounded-[2rem] bg-white dark:bg-white/[0.03] backdrop-blur-sm border border-gray-200 dark:border-white/5 hover:border-portfolio-royal-blue/20 transition-all duration-500 shadow-lg shadow-gray-200/50 dark:shadow-none hover:-translate-y-1">
                                
                                <!-- Primary Info: Title (Role) -->
                                <h3 class="text-xl md:text-2xl font-bold text-portfolio-royal-blue mb-3 leading-tight group-hover:opacity-80 transition-opacity duration-300">
                                    {item.title}
                                </h3>

                                <!-- Secondary Info: Logo + Company + Location -->
                                <div class="flex flex-wrap items-center gap-3 md:gap-4 mb-6">
                                    {item.logo && (
                                        <div class="w-10 h-10 md:w-10 md:h-10 rounded-xl bg-white p-2 shadow-sm border border-black/5 flex items-center justify-center transform group-hover:scale-105 transition-transform">
                                            <img src={item.logo} alt={item.subtitle} class="w-full h-full object-contain" />
                                        </div>
                                    )}
                                    <div class="flex flex-col">
                                        <div class="flex items-center gap-2">
                                            <span class="text-lg md:text-lg font-bold text-gray-500 dark:text-gray-400">
                                                {item.subtitle}
                                            </span>
                                            {item.link && (
                                                <a href={item.link} target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-portfolio-royal-blue transition-colors p-1">
                                                    <ExternalLink size={14} />
                                                </a>
                                            )}
                                        </div>
                                        <div class="flex items-center gap-1.5 text-[9px] md:text-[10px] font-black text-portfolio-royal-blue/60 dark:text-portfolio-royal-blue/40 uppercase tracking-[0.2em]">
                                            <MapPin class="w-[9px] h-[9px] md:w-[10px] md:h-[10px]" />
                                            {item.location}
                                        </div>
                                    </div>
                                </div>

                                <!-- Body: Achievements (Always Visible) -->
                                <div class="achievement-section border-t border-black/5 dark:border-white/5 mt-6 pt-6 font-Inter">
                                    <ul class="space-y-3">
                                        {item.items.map((point) => (
                                            <li class="flex items-start gap-3 md:gap-4 group/li">
                                                <div class={`mt-2 w-2 h-2 rounded-full transition-colors duration-300 flex-shrink-0 ${isWork ? 'bg-portfolio-navy/30 group-hover/li:bg-portfolio-navy' : 'bg-portfolio-royal-blue/30 group-hover/li:bg-portfolio-royal-blue'}`}></div>
                                                <p class="text-[13px] md:text-[15px] text-gray-600 dark:text-gray-400 leading-relaxed font-medium">
                                                    {point}
                                                </p>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            )
        })}
      </div>
    </div>
  </div>
</section>


<style>
  @keyframes track-flow {
    0% { transform: translateY(-300%); }
    100% { transform: translateY(300%); }
  }
  .animate-track-flow {
    animation: track-flow 10s linear infinite;
  }



  @keyframes pulse-slow {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.02); }
  }
  .animate-pulse-slow {
    animation: pulse-slow 12s ease-in-out infinite;
  }

  /* Hide scrollbar but keep functionality */
  .achievement-section::-webkit-scrollbar {
    display: none;
  }
</style>


